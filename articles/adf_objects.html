<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>ADF S3 Class Objects • adfExplorer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="ADF S3 Class Objects">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">adfExplorer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.3.0001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/adf_objects.html">ADF S3 Class Objects</a></li>
    <li><a class="dropdown-item" href="../articles/file_system_modes.html">ADF File System Modes</a></li>
    <li><a class="dropdown-item" href="../articles/version2.html">Version 2.0</a></li>
    <li><a class="dropdown-item" href="../articles/virtual_paths.html">Virtual Paths</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pepijn-devries/adfExplorer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>ADF S3 Class Objects</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pepijn-devries/adfExplorer/blob/master/vignettes/adf_objects.Rmd" class="external-link"><code>vignettes/adf_objects.Rmd</code></a></small>
      <div class="d-none name"><code>adf_objects.Rmd</code></div>
    </div>

    
    
<p>The <code>adfExplorer</code> package has defined several S3 class
objects to make interaction with virtual ADF devices easier. This page
presents these objects, what they are for and how they can be used.</p>
<div class="section level2">
<h2 id="adf_device">
<code>adf_device</code><a class="anchor" aria-label="anchor" href="#adf_device"></a>
</h2>
<div class="section level3">
<h3 id="what-is-it">What is it?<a class="anchor" aria-label="anchor" href="#what-is-it"></a>
</h3>
<p>Amiga Disk Files (ADF) or file representations of hardware disks. The
<code>adf_device</code> class is used to represent a connection to such
files. It can be seen as a virtual device. The file remains on disk, the
<code>adf_device</code> opens a file connection to it. Underneath the S3
class the object has the type <code>externalptr</code>.</p>
</div>
<div class="section level3">
<h3 id="how-can-it-be-initialized">How can it be initialized?<a class="anchor" aria-label="anchor" href="#how-can-it-be-initialized"></a>
</h3>
<p>The <code>adf_device</code> can be initiated by opening an ADF or ADZ
(a zipped ADF) file with <code><a href="../reference/connect_adf.html">connect_adf()</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pepijn-devries.github.io/adfExplorer/">adfExplorer</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">adz_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"example.adz"</span>, package <span class="op">=</span> <span class="st">"adfExplorer"</span><span class="op">)</span></span>
<span><span class="va">my_device</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_adf.html">connect_adf</a></span><span class="op">(</span><span class="va">adz_file</span><span class="op">)</span></span></code></pre></div>
<p>It can also be initiated by creating a new device with
<code><a href="../reference/create_adf_device.html">create_adf_device()</a></code>. As the device needs to be stored as a
file, you need to specify its destination path. The example below uses a
temporary file for this purpose.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adf_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".adf"</span><span class="op">)</span></span>
<span><span class="va">new_device</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_adf_device.html">create_adf_device</a></span><span class="op">(</span><span class="va">adf_file</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="what-can-i-do-with-it">What can I do with it?<a class="anchor" aria-label="anchor" href="#what-can-i-do-with-it"></a>
</h3>
<p>Well, that depends. When you just created a device with
<code><a href="../reference/create_adf_device.html">create_adf_device()</a></code>, like the object named
<code>new_device</code> in the example above, it does not contain a file
system (see <code><a href="../articles/file_system_modes.html">vignette("file_system_modes")</a></code>). Virtual disks
without a file system, could contain unspecified data or a custom track
loader, which can contain instructions running independently from the
operating system. You can inspect those disks by reading and writing <a href="#adf_block">blocks</a>, the logical unit of data on a disk.</p>
<p>When a virtual disk does contain a file system, like the one opened
with <code><a href="../reference/connect_adf.html">connect_adf()</a></code> stored as the object named
<code>my_device</code>, you can do a lot more. You can query the files
and directories on the disk. Read, write, copy, move, manipulate and
delete those files. The example below shows how to list the entries
(files and directories) on the disk’s root.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_adf_entries.html">list_adf_entries</a></span><span class="op">(</span><span class="va">my_device</span><span class="op">)</span></span>
<span><span class="co">#&gt; DIR  DEWR...     Devs</span></span>
<span><span class="co">#&gt; DIR  DEWR...        S</span></span>
<span><span class="co">#&gt; DIR  DEWR...     this</span></span>
<span><span class="co">#&gt; DIR  DEWR...     mods</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="end-of-life">End of life<a class="anchor" aria-label="anchor" href="#end-of-life"></a>
</h3>
<p>As any <code>externalptr</code> object an <code>adf_device</code>
will be cleaned up automatically by R’s garbage collector when it goes
out of scope. However, as it maintains an open connection to a file on
disk, it is always wise to <code><a href="https://rdrr.io/r/base/connections.html" class="external-link">close()</a></code> the device when you are
done with it. Calling <code><a href="https://rdrr.io/r/base/connections.html" class="external-link">close()</a></code> on an <code>adf_device</code>
will also automatically close all nested connections to files on the
virtual device (see also <a href="#adf_file_con"><code>adf_file_con</code></a>)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">close</a></span><span class="op">(</span><span class="va">new_device</span><span class="op">)</span></span>
<span><span class="co">## Let's keep `my_device` open to be used in examples below</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="adf_file_con">
<code>adf_file_con</code><a class="anchor" aria-label="anchor" href="#adf_file_con"></a>
</h2>
<div class="section level3">
<h3 id="what-is-it-1">What is it?<a class="anchor" aria-label="anchor" href="#what-is-it-1"></a>
</h3>
<p>It is a connection to a file on a virtual device represented by the
<a href="#adf_device"><code>adf_device</code></a> class objects. Well…
Technically, it isn’t a connection really, because CRAN’s policy does
not allow to call non API entry points into R. This would be required to
setup a proper connection. Instead, the <code>adf_file_con</code> is a
mockup using an <code>externalptr</code> type to mimic R connections. In
essence, it behaves very much like any other connection in R (more
details below).</p>
</div>
<div class="section level3">
<h3 id="how-can-it-be-initialized-1">How can it be initialized?<a class="anchor" aria-label="anchor" href="#how-can-it-be-initialized-1"></a>
</h3>
<p>An <code>adf_file_con</code> object can be initiated using a call to
<code><a href="../reference/adf_file_con.html">adf_file_con()</a></code>. For this purpose, you first need to connect
to a virtual device containing a file system. We’ll use
<code>my_device</code> opened in earlier examples. We can use the path
to a file on a virtual device to open a connection as shown below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adf_file_con.html">adf_file_con</a></span><span class="op">(</span><span class="va">my_device</span>, <span class="st">"DF0:mods/mod.intro"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span>
<span><span class="co">#&gt; $description</span></span>
<span><span class="co">#&gt; [1] "mod.intro"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $class</span></span>
<span><span class="co">#&gt; [1] "adf_file_con"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mode</span></span>
<span><span class="co">#&gt; [1] "rb"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $text</span></span>
<span><span class="co">#&gt; [1] "binary"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $opened</span></span>
<span><span class="co">#&gt; [1] "opened"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`can read`</span></span>
<span><span class="co">#&gt; [1] "yes"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`can write`</span></span>
<span><span class="co">#&gt; [1] "no"</span></span></code></pre></div>
<p>If you want to open writable connections to a virtual device, you
need to initiate the device without write protection. A writable
connection can also be used to create new files on the virtual
device.</p>
</div>
<div class="section level3">
<h3 id="what-can-i-do-with-it-1">What can I do with it?<a class="anchor" aria-label="anchor" href="#what-can-i-do-with-it-1"></a>
</h3>
<p>Depending on how you set the option <code>writable</code> when
calling <code>adf_file_con</code>, you can either read and / or write to
the connection. By default the connection is opened as read-only. You
can use <code><a href="../reference/read_write.html">readBin()</a></code> to read binary data from the
connection.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_write.html">readBin</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"raw"</span>, <span class="fl">20L</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 69 6e 74 72 6f 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</span></span></code></pre></div>
<p>Note that <code><a href="../reference/adf_file_con.html">adf_file_con()</a></code> always opens the connection as
‘binary’, but you can also use it for reading and writing text. So
basically, <code><a href="../reference/read_write.html">readLines()</a></code>, <code><a href="../reference/read_write.html">writeBin()</a></code> and
<code><a href="../reference/read_write.html">writeLines()</a></code> are all available (the latter two obviously
when the connection is writable).</p>
<p>In addition, you can tell where the current byte offset in the file
is located with <code><a href="https://rdrr.io/r/base/seek.html" class="external-link">seek()</a></code>. You can also use it to set the
offset to a specific location.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/seek.html" class="external-link">seek</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 20</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/seek.html" class="external-link">seek</a></span><span class="op">(</span><span class="va">con</span>, <span class="fl">30L</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 30</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="end-of-life-1">End of life<a class="anchor" aria-label="anchor" href="#end-of-life-1"></a>
</h3>
<p>Like any connection it is good practice to <code><a href="https://rdrr.io/r/base/connections.html" class="external-link">close()</a></code> it
when you are done. Any <code>adf_file_con</code> still open when its
parent <code>adf_device</code> is closed, will automatically be closed.
It can no longer be accessed when the virtual device is not
available.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">close</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="virtual_path">
<code>virtual_path</code><a class="anchor" aria-label="anchor" href="#virtual_path"></a>
</h2>
<div class="section level3">
<h3 id="what-is-it-2">What is it?<a class="anchor" aria-label="anchor" href="#what-is-it-2"></a>
</h3>
<p>It is a vectorised <code>list</code> of <code>list</code>s. The
nested list contains two elements:</p>
<ol style="list-style-type: decimal">
<li>An <code>adf_device</code> class object</li>
<li>A <code>character</code> string, specifying a path to a file or
directory on the virtual device.</li>
</ol>
<p>The outer list just contains a collection of these.</p>
</div>
<div class="section level3">
<h3 id="how-can-it-be-initialized-2">How can it be initialized?<a class="anchor" aria-label="anchor" href="#how-can-it-be-initialized-2"></a>
</h3>
<p>It can be initialised by calling <code><a href="../reference/virtual_path.html">virtual_path()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/virtual_path.html">virtual_path</a></span><span class="op">(</span><span class="va">my_device</span>, <span class="st">"DF0:s/startup-sequence"</span><span class="op">)</span></span>
<span><span class="co">#&gt; FILE DEWR----   0.6 kB Startup-Sequence</span></span>
<span><span class="fu"><a href="../reference/virtual_path.html">virtual_path</a></span><span class="op">(</span><span class="va">my_device</span>, <span class="st">"idontexist"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Invalid path</span></span></code></pre></div>
<p>Note that the file does not necessarily have to exist in order to
create a virtual path. It doesn’t create any kind of connection to the
file, but you can use it to open one.</p>
</div>
<div class="section level3">
<h3 id="what-can-i-do-with-it-2">What can I do with it?<a class="anchor" aria-label="anchor" href="#what-can-i-do-with-it-2"></a>
</h3>
<p>The <code>virtual_path</code> is a means to refer to files and
directory on a virtual device. It also helps to set up processes with
the pipe operator (<code>|&gt;</code>). There is a
<code>vignette("virtual_path")</code> dedicated to describing the object
and its usage in more detail.</p>
</div>
<div class="section level3">
<h3 id="end-of-life-2">End of life<a class="anchor" aria-label="anchor" href="#end-of-life-2"></a>
</h3>
<p>It is just a list. You can just call <code><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm()</a></code> on it to get
rid of it.</p>
</div>
</div>
<div class="section level2">
<h2 id="adf_block">
<code>adf_block</code><a class="anchor" aria-label="anchor" href="#adf_block"></a>
</h2>
<div class="section level3">
<h3 id="what-is-it-3">What is it?<a class="anchor" aria-label="anchor" href="#what-is-it-3"></a>
</h3>
<p>A representation of <code>raw</code> data of a logical unit on a
virtual device of 512 bytes. It is simply a <code>vector</code> of
<code>raw</code> data.</p>
</div>
<div class="section level3">
<h3 id="how-can-it-be-initialized-3">How can it be initialized?<a class="anchor" aria-label="anchor" href="#how-can-it-be-initialized-3"></a>
</h3>
<p>A new block block can be created with <code><a href="../reference/adf_block.html">new_adf_block()</a></code>.
It will be initialised with null bytes. You can also coerce a
<code>raw</code> <code>vector</code> to an <code>adf_block</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">block1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adf_block.html">new_adf_block</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## a block with random data</span></span>
<span><span class="va">block2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adf_block.html">as_adf_block</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/raw.html" class="external-link">as.raw</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">256L</span>, size <span class="op">=</span> <span class="fl">512L</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>You can also intialise a block by reading it from a virtual
device</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## This will read the initial 'boot' block</span></span>
<span><span class="co">## from the virtual device</span></span>
<span><span class="va">block3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adf_block.html">read_adf_block</a></span><span class="op">(</span><span class="va">my_device</span>, <span class="fl">0L</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="what-can-i-do-with-it-3">What can I do with it?<a class="anchor" aria-label="anchor" href="#what-can-i-do-with-it-3"></a>
</h3>
<p>You can read blocks from a virtual disk with
<code><a href="../reference/adf_block.html">read_adf_block()</a></code> and write them to a specific sector on the
virtual disk with <code><a href="../reference/adf_block.html">write_adf_block()</a></code>. But be careful you can
damage the file system or track loader of the virtual disk if you don’t
know what you are doing.
<!-- add link to block vignette with more detail here once it is written --></p>
</div>
<div class="section level3">
<h3 id="end-of-life-3">End of life<a class="anchor" aria-label="anchor" href="#end-of-life-3"></a>
</h3>
<p>It can just be removed from memory by calling <code><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm()</a></code>. As
there is no actual link to the virtual device, removing an
<code>adf_block</code> class object from memory does not affect your
virtual device.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">block1</span>, <span class="va">block2</span>, <span class="va">block3</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pepijn de Vries, Laurent Clévy.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
