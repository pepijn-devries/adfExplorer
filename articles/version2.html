<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Version 2.0 • adfExplorer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Version 2.0">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">adfExplorer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/adf_objects.html">ADF S3 Class Objects</a></li>
    <li><a class="dropdown-item" href="../articles/file_system_modes.html">ADF File System Modes</a></li>
    <li><a class="dropdown-item" href="../articles/version2.html">Version 2.0</a></li>
    <li><a class="dropdown-item" href="../articles/virtual_paths.html">Virtual Paths</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pepijn-devries/adfExplorer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Version 2.0</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pepijn-devries/adfExplorer/blob/master/vignettes/version2.Rmd" class="external-link"><code>vignettes/version2.Rmd</code></a></small>
      <div class="d-none name"><code>version2.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="motivation-for-adfexplorer-version-2">Motivation for adfExplorer version 2<a class="anchor" aria-label="anchor" href="#motivation-for-adfexplorer-version-2"></a>
</h2>
<p>This vignette explains why version 2.0.0 was completely rewritten. It
will also provide some hands on examples showing how versions &gt;=2.0.0
work differently from older versions and how you can modify your R code
when you are switching the latest version.</p>
<p>Below version 2.0.0 everything was coded in <code>R</code>. Although,
technically a lot could be achieved, it was not very effective. In order
to work with Amiga Disk Files, the entire file first needed to be copied
into memory, and than save the object in memory back to disk after
manipulation.</p>
<p>Consider the case where you want to extract a file from a virtual
disk and store it on your local drive. The schematics below show the
process in the old situation. The ADF file first needs to be copied to
memory. The file data from that object needs to be extracted from that
copy. After which the file data can be stored to disk:</p>
<div class="float">
<img src="../reference/figures/diagram_old.svg" alt="Diagram of extracting a file with adfExplorer &lt;2.0.0"><div class="figcaption">Diagram of extracting a file with adfExplorer
&lt;2.0.0</div>
</div>
<p>After working on this approach for a while, I learned about the
existence of <a href="https://github.com/lclevy/ADFlib" class="external-link">ADFlib</a>. This
is when I decided to start from scratch and set up a more efficient
design resulting in version 2.0.0. There I took the <code>C</code> code
from <code>ADFlib</code> and build an interface to <code>R</code> in
<code>C++</code>. This strategy had several advantages:</p>
<ul>
<li>The wheel doesn’t have to be reinvented, as <code>ADFlib</code>
already implemented the core functionalities for interacting with Amiga
Disk Files.</li>
<li>By coding in <code>C</code> and <code>C++</code>:
<ul>
<li>Custom <code>R</code> connections can be created. This allows you to
modify the ADF files in place without having to copy them to memory
first.</li>
<li>The program needs to be compiled</li>
</ul>
</li>
</ul>
<p>Because the new strategy doesn’t need to move data back and forth to
memory and uses compiled code, it is much faster (see also the benchmark
test below).</p>
<p>Furthermore, you can create connections to files on the virtual
device and directly read from or write to those files. There is no more
need to create physical copies of the virtual file.</p>
<p>The process of extracting a file from an ADF device with version
2.0.0 and up would look something like this:</p>
<div class="float">
<img src="../reference/figures/diagram_new.svg" alt="Diagram of extracting a file with adfExplorer &gt;=2.0.0"><div class="figcaption">Diagram of extracting a file with adfExplorer
&gt;=2.0.0</div>
</div>
</div>
<div class="section level2">
<h2 id="switching-from-version-2-to-2">Switching from version &lt;2 to &gt;=2<a class="anchor" aria-label="anchor" href="#switching-from-version-2-to-2"></a>
</h2>
<p>When you have code using <code>adfExplorer</code> versions below
2.0.0, I recommend switching to a newer version at your earliest
convenience. Partly because of the reasons listed above, but also many
functions from the old release are deprecated. As versions of 2.0.0 and
up use a different syntax, I have put some examples side by side, to
help you translate your code.</p>
<p>Let’s start by opening a Amiga Disk File:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adz_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"example.adz"</span>, package <span class="op">=</span> <span class="st">"adfExplorer"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ---------------- adfExplorer</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pepijn-devries.github.io/adfExplorer/">adfExplorer</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ---------------- Old code</span></span>
<span><span class="co"># my_disk1 &lt;- read.adz(adz_file)</span></span>
<span></span>
<span><span class="co"># ---------------- New code</span></span>
<span><span class="va">my_disk2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_adf.html">connect_adf</a></span><span class="op">(</span><span class="va">adz_file</span><span class="op">)</span></span></code></pre></div>
<p>Show and change the current dir:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ---------------- Old code</span></span>
<span><span class="co"># current.adf.dir(my_disk1)</span></span>
<span><span class="co"># current.adf.dir(my_disk1) &lt;- "s"</span></span>
<span></span>
<span><span class="co"># ---------------- New code</span></span>
<span><span class="fu"><a href="../reference/adf_directory.html">adf_directory</a></span><span class="op">(</span><span class="va">my_disk2</span><span class="op">)</span></span>
<span><span class="co">#&gt; ROOT                   adfExampleOFS</span></span>
<span><span class="fu"><a href="../reference/adf_directory.html">adf_directory</a></span><span class="op">(</span><span class="va">my_disk2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"s"</span></span></code></pre></div>
<p>List entries in a directory. Note that versions 2.0.0 and up have the
capability to list the entries recursively (in all nested
subdirectories):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ---------------- Old code</span></span>
<span><span class="co"># list.adf.files(my_disk1, "DF0:")</span></span>
<span></span>
<span><span class="co"># ---------------- New code</span></span>
<span><span class="fu"><a href="../reference/list_adf_entries.html">list_adf_entries</a></span><span class="op">(</span><span class="va">my_disk2</span>, <span class="st">"DF0:"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; DIR  DEWR...     Devs</span></span>
<span><span class="co">#&gt; FILE DEWR...iguration</span></span>
<span><span class="co">#&gt; DIR  DEWR...        S</span></span>
<span><span class="co">#&gt; FILE DEWR...-Sequence</span></span>
<span><span class="co">#&gt; DIR  DEWR...     this</span></span>
<span><span class="co">#&gt; DIR  DEWR...       is</span></span>
<span><span class="co">#&gt; DIR  DEWR...        a</span></span>
<span><span class="co">#&gt; DIR  DEWR...     deep</span></span>
<span><span class="co">#&gt; DIR  DEWR...     path</span></span>
<span><span class="co">#&gt; DIR  DEWR...     mods</span></span>
<span><span class="co">#&gt; FILE DEWR...mod.intro</span></span></code></pre></div>
<p>Read from a file on the virtual disk:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ---------------- Old code</span></span>
<span><span class="co"># get.adf.file(my_disk1, "startup-sequence") |&gt;</span></span>
<span><span class="co">#   rawToChar()</span></span>
<span></span>
<span><span class="co"># ---------------- New code</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adf_file_con.html">adf_file_con</a></span><span class="op">(</span><span class="va">my_disk2</span>, <span class="st">"startup-sequence"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/read_write.html">readLines</a></span><span class="op">(</span><span class="va">con</span>, warn <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "; The Startup-Sequence is executed after booting"                                                                                         </span></span>
<span><span class="co">#&gt;  [2] "; Everything after semicolons are comments and is ignored"                                                                                </span></span>
<span><span class="co">#&gt;  [3] "; By default standard commands are loaded from"                                                                                           </span></span>
<span><span class="co">#&gt;  [4] "; the ROM kickstart. Additional commands should be"                                                                                       </span></span>
<span><span class="co">#&gt;  [5] "; stored on the disk in the SYS:C directory."                                                                                             </span></span>
<span><span class="co">#&gt;  [6] "; For demonstration purposes we only echo some"                                                                                           </span></span>
<span><span class="co">#&gt;  [7] "; text to the screen... Note that this will not"                                                                                          </span></span>
<span><span class="co">#&gt;  [8] "; work on Amiga OS &lt;2.0 as \"Echo\" is not available"                                                                                     </span></span>
<span><span class="co">#&gt;  [9] "; in older ROM kickstart versions."                                                                                                       </span></span>
<span><span class="co">#&gt; [10] ""                                                                                                                                         </span></span>
<span><span class="co">#&gt; [11] "Echo \"\033c\033[22m\033[32mADF Explorer Example Disk\" ; Note that the weird characters at the start are escape-codes to format the text"</span></span>
<span><span class="co">#&gt; [12] "Echo \"\033[0mThis disk was created as an example for the\""                                                                              </span></span>
<span><span class="co">#&gt; [13] "Echo \"R package 'adfExplorer' by Pepijn de Vries.\""</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">close</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></code></pre></div>
<p>Clean up after yourself:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ---------------- Old code</span></span>
<span><span class="co"># rm(my_disk1)</span></span>
<span></span>
<span><span class="co"># ---------------- New code</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">close</a></span><span class="op">(</span><span class="va">my_disk2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">my_disk2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="benchmarking-version-0-1-8-against-2-0-0">Benchmarking version 0.1.8 against 2.0.0<a class="anchor" aria-label="anchor" href="#benchmarking-version-0-1-8-against-2-0-0"></a>
</h2>
<p>A set of tasks were defined to evaluate computational time: open an
ADF file; show the current dir; set the current directory to a specific
path; read a small text file from the virtual device; list all dir and
file entries on the disk’s root. The plot below shows the time it took
to complete these tasks with both version 0.1.8 and version 2.0.0. The
latter is nearly 5 times faster than the older version.</p>
<div class="float">
<img src="../reference/figures/benchmark.png" width="300" alt="Barplot of benchmark test results"><div class="figcaption">Barplot of benchmark test results</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pepijn de Vries, Laurent Clévy.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
